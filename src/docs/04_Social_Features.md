# 4. الميزات الاجتماعية (Social Features)

---

تهدف الميزات الاجتماعية إلى ربط اللاعبين ببعضهم البعض، خلق روح من المنافسة الودية، وتمهيد الطريق لميزات تعاونية في المستقبل. تعتمد هذه الأنظمة بشكل أساسي على **Firebase** لإدارة بيانات المستخدمين والمصادقة.

## 1. لوحة المتصدرين (Leaderboard)

لوحة المتصدرين هي الميزة الاجتماعية الرئيسية الحالية، حيث تعرض قائمة بأفضل اللاعبين بناءً على نقاط الخبرة (XP).

-   **آلية العمل:**
    1.  **جلب البيانات:** عند فتح الصفحة، يقوم `CommunityService` بجلب مجموعتين من البيانات من Firestore:
        -   مجموعة `users`: تحتوي على معلومات الحساب الأساسية مثل البريد الإلكتروني والدور (role).
        -   مجموعة `players`: تحتوي على بيانات حالة اللعبة لكل لاعب، مثل المستوى (level) والخبرة (XP).
    2.  **دمج البيانات:** يتم دمج البيانات من المجموعتين باستخدام `uid` (معرف المستخدم) لإنشاء قائمة عرض موحدة.
    3.  **الترتيب:** يتم ترتيب القائمة تنازليًا بناءً على `xp`.
    4.  **العرض:** يتم عرض القائمة مع تمييز اللاعب الحالي وإظهار أيقونات خاصة لأصحاب المراكز الثلاثة الأولى.

-   **البيانات المعروضة لكل لاعب:**
    -   الترتيب (Rank)
    -   الاسم (حاليا البريد الإلكتروني)
    -   المستوى (Level)
    -   نقاط الخبرة (XP)
    -   علامة "أنت" (You) للاعب الحالي.

---

## 2. المصادقة وملفات اللاعبين (Authentication & Profiles)

لتمكين الميزات الاجتماعية وحفظ تقدم اللاعبين بشكل آمن، تستخدم اللعبة **Firebase Authentication**.

-   **نظام المصادقة:**
    -   **التسجيل والدخول:** يمكن للاعبين إنشاء حساب جديد أو تسجيل الدخول باستخدام البريد الإلكتروني وكلمة المرور.
    -   **إدارة الجلسة:** يعالج `AuthenticationService` حالة المصادقة (loading, authenticated, unauthenticated) ويعرض تلقائيًا صفحة تسجيل الدخول أو واجهة اللعبة الرئيسية.
    -   **ربط البيانات:** يتم استخدام `uid` الفريد من Firebase لربط حساب المصادقة بملف تعريف المستخدم في مجموعة `users` وبيانات اللعبة في مجموعة `players`.

### بنية البيانات في Firestore:

-   **مجموعة `users`:**
    -   المعرف (Document ID): `uid` الخاص بالمستخدم.
    -   الحقول:
        -   `email`: البريد الإلكتروني للمستخدم.
        -   `role`: دور المستخدم (`player` أو `admin`).
        -   `createdAt`: تاريخ إنشاء الحساب.

-   **مجموعة `players`:**
    -   المعرف (Document ID): `uid` الخاص بالمستخدم.
    -   الحقول:
        -   `playerState`: كائن يحتوي على جميع بيانات تقدم اللاعب (coins, xp, inventory, etc.).

-   **الفصل بين البيانات:** هذا الفصل بين بيانات الحساب وبيانات اللعبة يسمح بمرونة أكبر في المستقبل (على سبيل المثال، يمكن للاعب أن يمتلك شخصيات متعددة تحت حساب واحد).

### أدوار المستخدمين (User Roles)

-   **`player` (لاعب):** الدور الافتراضي لأي حساب جديد. يمتلك الوصول إلى جميع ميزات اللعب العادية.
-   **`admin` (مسؤول):** يمتلك وصولاً إلى "لوحة التحكم" (Admin Panel) التي تسمح له بإدارة اللاعبين ومحتوى اللعبة.
