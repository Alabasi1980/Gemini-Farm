# 3. الأنظمة المتقدمة (Advanced Systems)

---

هذا المستند يغطي الأنظمة الديناميكية والفريدة التي تميز Gemini Farm وتوفر عمقًا استراتيجيًا وتجربة لعب متجددة.

## 1. نظام المهام بالذكاء الاصطناعي (AI Task System)

بدلاً من الاعتماد على قائمة مهام ثابتة ومملة، تستخدم اللعبة **Google Gemini API** لإنشاء مهام يومية مخصصة لكل لاعب.

-   **الهدف من النظام:**
    -   توفير تحديات جديدة كل يوم.
    -   جعل المهام ملائمة لمستوى اللاعب الحالي وقدراته الإنتاجية.
    -   تشجيع اللاعب على استكشاف جوانب مختلفة من اللعبة.

-   **آلية العمل:**
    1.  **جمع السياق (Context Gathering):** عندما يطلب اللاعب مهامًا جديدة، يقوم النظام بتجميع كائن `PlayerTaskContext` يحتوي على معلومات حول حالة اللاعب الحالية:
        -   المستوى (Level) والخبرة (XP).
        -   المحتويات الحالية للمخزون (Inventory).
        -   قائمة المصانع التي يمتلكها (Owned Factories).
        -   معرفات المهام الحالية لتجنب التكرار.
    2.  **إرسال الطلب إلى Gemini:** يتم إرسال هذا السياق إلى Gemini API مع `systemInstruction` واضحة تطلب إنشاء 3 مهام جديدة بناءً على هذه البيانات.
    3.  **تلقي ومعالجة الاستجابة:** يتلقى النظام استجابة بصيغة JSON تحتوي على مصفوفة من المهام، ويتم عرضها للاعب.

-   **مثال على مهمة:** إذا كان اللاعب يمتلك "Mill" (طاحونة) ولديه "Wheat" (قمح)، قد يقوم الذكاء الاصطناعي بإنشاء مهمة تطلب منه "إنتاج 5 أكياس من الدقيق (Flour)". هذه المهمة تشجعه على استخدام مصنعه.

---

## 2. السوق الديناميكي (Dynamic Market)

لإضافة طبقة من الاستراتيجية ومنع اللعب الروتيني، فإن أسعار بيع المنتجات ليست ثابتة.

-   **آلية العمل:**
    -   **التحديث الدوري:** كل دقيقتين، يقوم `MarketService` بتحديث "معاملات الأسعار" (`priceModifiers`) لجميع السلع القابلة للبيع.
    -   **التقلبات العشوائية:** كل سلعة تحصل على تقلب طفيف في سعرها (على سبيل المثال، بين -20% و +20%) بشكل عشوائي في كل دورة تحديث.
    -   **أحداث السوق (Market Events):** هناك فرصة (مثل 50%) لحدوث "حدث سوق" خاص في كل دورة. هذه الأحداث تؤثر بشكل كبير على سعر سلعة معينة لفترة محدودة.

-   **مثال على حدث سوق:**
    -   `"Wheat Demand Spike! Sell price +50%"`
    -   خلال هذا الحدث، سيتم بيع القمح بسعر أعلى بنسبة 50% من سعره الأساسي، مما يشجع اللاعبين على بيع مخزونهم من القمح فورًا.

-   **العرض للاعب:** يتم عرض هذه الأحداث عبر شريط إخباري متحرك (Ticker) في أسفل الشاشة، ويتم عرض اتجاه سعر كل سلعة (مرتفع/منخفض) في صفحة المخزون.

---

## 3. الأتمتة والعمال (Automation & Workers)

لتقليل المهام المتكررة في مراحل اللعبة المتقدمة وإضافة عنصر اللعب الخامل (Idle Gameplay)، يمكن للاعبين تفعيل العمال الآليين.

-   **العامل الحالي: Harvester Bot (روبوت الحصاد)**
    -   **الوظيفة:** يقوم هذا العامل بالبحث تلقائيًا عن المهام الجاهزة وتنفيذها.
    -   **التفعيل:** يمكن للاعب تفعيل أو إلغاء تفعيل العامل في أي وقت.

-   **منطق اتخاذ القرار (Task-Finding Logic):**
    -   يعمل الروبوت بأولويات محددة. في كل دورة عمل، يبحث عن:
        1.  **محاصيل جاهزة للحصاد:** إذا وجد، يتحرك إلى قطعة الأرض ويحصدها.
        2.  **منتجات حيوانية جاهزة للجمع:** إذا لم يجد محاصيل، يبحث عن حظائر حيوانات جاهزة ويجمع منتجاتها.
        3.  **منتجات مصانع جاهزة للجمع:** إذا لم يجد أيًا مما سبق، يبحث عن مصانع جاهزة ويجمع منتجاتها.
    -   بعد كل مهمة، يعود إلى حالة "الخمول" (Idle) ويبدأ البحث من جديد في الدورة التالية.

-   **التطور المستقبلي:** يمكن بسهولة إضافة عمال جدد بوظائف مختلفة (مثل عامل زراعة، عامل بيع) بنفس المنطق.
