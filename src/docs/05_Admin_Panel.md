# 5. لوحة التحكم (Admin Panel)

---

لوحة التحكم هي قسم خاص داخل اللعبة لا يمكن الوصول إليه إلا من قبل المستخدمين الذين لديهم دور `admin`. توفر هذه اللوحة أدوات قوية لإدارة اللاعبين ومحتوى اللعبة مباشرة من واجهة المستخدم، مما يسهل عملية الاختبار، الدعم، وتحديث اللعبة.

تنقسم لوحة التحكم حاليًا إلى ثلاثة أقسام رئيسية: **إدارة اللاعبين**، **إدارة المحتوى**، و **المراقبة والتشخيص**.

## 1. إدارة اللاعبين (Player Management)

هذا القسم يوفر نظرة شاملة على جميع اللاعبين المسجلين في اللعبة ويسمح للمسؤولين بإجراء تعديلات سريعة على حساباتهم.

-   **الميزات:**
    -   **عرض قائمة اللاعبين:** يتم عرض جدول يحتوي على جميع اللاعبين مع معلوماتهم الأساسية:
        -   البريد الإلكتروني و UID.
        -   المستوى (Level).
        -   العملات (Coins).
        -   نقاط الخبرة (XP).
    -   **فرز البيانات:** يتم فرز القائمة افتراضيًا حسب المستوى الأعلى، مما يسهل رؤية اللاعبين الأكثر تقدمًا.
    -   **إضافة Coins/XP:** يمكن للمسؤول النقر على أزرار "Add" بجانب أي لاعب لفتح نافذة منبثقة.
    -   **نافذة التعديل:** تسمح النافذة للمسؤول بإدخال كمية محددة من Coins أو XP وإضافتها مباشرة إلى رصيد اللاعب. يتم تحديث البيانات في قاعدة البيانات وفي واجهة المستخدم بشكل فوري.
    -   **سجل التدقيق (Audit Log):** جميع الإجراءات الحساسة (مثل منح العملات) يتم تسجيلها تلقائيًا ويمكن مراجعتها في قسم سجل التدقيق.

-   **حالات الاستخدام:**
    -   مكافأة اللاعبين على مشاركتهم في اختبارات.
    -   تعويض اللاعبين عن أي مشاكل تقنية قد تواجههم.
    -   تسريع عملية اختبار الميزات الجديدة التي تتطلب مستويات أو موارد معينة.

---

## 2. إدارة المحتوى (Content Management)

هذا القسم هو نظام إدارة محتوى (CMS) مدمج يسمح للمسؤولين بالتحكم الكامل في جميع بيانات اللعبة الثابتة (مثل المحاصيل، المباني، الوصفات) دون الحاجة إلى تعديل الكود أو الوصول المباشر إلى قاعدة البيانات.

### الهيكل القائم على التبويبات (Tab-Based Structure)

-   تم تصميم الواجهة بنظام تبويبات (Tabs) لتنظيم أنواع المحتوى المختلفة. كل تبويب مخصص لنوع معين من البيانات (حاليا: Crops, Placeable Items).
-   هذا التصميم قابل للتوسيع بسهولة في المستقبل لإضافة تبويبات جديدة (مثل Recipes, Animal Products, إلخ).

### أ. إدارة المحاصيل (Crops Management)

-   **عرض (Read):** جدول يعرض جميع المحاصيل الموجودة في قاعدة البيانات مع خصائصها الرئيسية (ID, Name, Cost, Sell Price, Growth Time).
-   **إنشاء (Create):** زر "Create New Crop" يفتح نموذجًا شاملاً يسمح للمسؤول بإدخال جميع تفاصيل المحصول الجديد، بما في ذلك:
    -   المعلومات الأساسية (ID, Name, Description).
    -   البيانات الاقتصادية (Plant Cost, Sell Price).
    -   بيانات النمو (Growth Time, Unlock Level, Season Modifiers).
    -   مراحل النمو (Growth Stages): واجهة ديناميكية لإضافة/حذف مراحل النمو وتحديد مظهرها ونسبة مدتها.
-   **تعديل (Update):** زر "Edit" بجانب كل محصول يفتح نفس النموذج مع ملء البيانات الحالية، مما يسمح بتعديل أي خاصية.
-   **حذف (Delete):** زر "Delete" يسمح بحذف محصول. تظهر نافذة تأكيد لمنع الحذف العرضي.

### ب. إدارة العناصر القابلة للوضع (Placeable Items Management)

-   **عرض (Read):** جدول يعرض جميع العناصر (الديكورات، المباني، المصانع، إلخ) مع تفاصيلها.
-   **إنشاء وتعديل (Create/Update):** يفتح نموذجًا "ذكيًا" تتغير حقوله بناءً على نوع العنصر المحدد (`type`).
    -   إذا كان النوع `decoration`، تظهر الحقول الأساسية فقط.
    -   إذا كان النوع `animal_housing`، تظهر حقول إضافية لتحديد المنتج ومدة الإنتاج.
    -   إذا كان النوع `factory`، تظهر حقول خاصة بالوصفات، حجم قائمة الانتظار، وتكاليف الترقية.
-   **حذف (Delete):** نفس آلية الحذف الآمن الموجودة في قسم المحاصيل.

-   **التحديث الفوري:** بعد أي عملية إنشاء أو تعديل أو حذف، يقوم النظام تلقائيًا بإعادة تحميل محتوى اللعبة من قاعدة البيانات، مما يضمن أن التغييرات تنعكس على الفور في جميع أنحاء اللعبة (بما في ذلك المتجر، المخزون، والمزرعة).

---

## 3. المراقبة والتشخيص (Observability)

هذا القسم يوفر أدوات لمراقبة صحة التطبيق وسلوك اللاعبين.

### أ. سجل الأخطاء (Error Logs)

-   **الهدف:** تسجيل أي أخطاء غير متوقعة تحدث من جانب العميل (المتصفح) تلقائيًا.
-   **البيانات المسجلة:** لكل خطأ، يتم تسجيل:
    -   الطابع الزمني (Timestamp).
    -   معلومات المستخدم (UID, Email).
    -   رسالة الخطأ (Error Message).
    -   تتبع المكدس (Stack Trace) للمساعدة في تحديد مصدر الخطأ.
    -   السياق (Context) الذي حدث فيه الخطأ.
-   **الفائدة:** تمكن المطورين من اكتشاف المشاكل التي يواجهها اللاعبون وإصلاحها بشكل استباقي حتى لو لم يقم اللاعب بالإبلاغ عنها.

### ب. سجل الأحداث (Analytics Events)

-   **الهدف:** تتبع الإجراءات الرئيسية التي يقوم بها اللاعبون لفهم سلوكهم وتحسين تجربة اللعب.
-   **الأحداث المسجلة حاليًا:**
    -   `session_start`: عند بدء جلسة اللعب.
    -   `first_plant`: عند أول عملية زراعة.
    -   `first_harvest`: عند أول عملية حصاد.
    -   `task_completed`: عند المطالبة بمكافأة مهمة.
-   **البيانات المسجلة:** لكل حدث، يتم تسجيل الطابع الزمني، معلومات المستخدم، اسم الحدث، وتفاصيل إضافية خاصة بالحدث.
-   **الفائدة:** تساعد في تحليل رحلة اللاعب، تحديد نقاط الصعوبة، وموازنة اللعبة بشكل أفضل.