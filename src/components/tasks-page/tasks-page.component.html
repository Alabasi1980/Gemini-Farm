<div class="p-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-purple-400">Daily Tasks</h1>
    <button (click)="generateTasks()" [disabled]="loading()" class="flex items-center space-x-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800/50 disabled:cursor-wait text-white font-bold rounded-lg transition-colors shadow-lg">
      <span class="text-xl">âœ¨</span>
      <span>{{ tasks().length > 0 ? 'Generate New' : 'Generate Daily Tasks' }}</span>
    </button>
  </div>

  @if(loading()) {
    <div class="text-center py-20 bg-slate-800/50 rounded-lg">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-400 mx-auto"></div>
      <p class="mt-4 text-purple-300 font-semibold">Gemini is thinking of new tasks...</p>
    </div>
  } @else if (error()) {
    <div class="text-center py-12 bg-red-900/50 border border-red-700 rounded-lg">
      <p class="text-red-300 font-bold text-lg">Oops! Something went wrong.</p>
      <p class="mt-2 text-red-400">{{ error() }}</p>
    </div>
  } @else if (displayTasks().length === 0) {
    <div class="text-center py-20 bg-slate-800/50 rounded-lg">
      <p class="text-slate-400 text-lg">No tasks available right now.</p>
      <p class="text-slate-500 mt-2">Click the "Generate Daily Tasks" button to get started!</p>
    </div>
  } @else {
    <div class="space-y-4">
      @for (task of displayTasks(); track task.id) {
        @if(task.state) {
          <div class="bg-slate-800 border border-slate-700 rounded-lg p-4 flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-6">
            <!-- Task Info -->
            <div class="flex-grow w-full">
              <p class="font-semibold text-lg text-white">{{ task.description }}</p>
              
              <!-- Progress Bar -->
              <div class="flex items-center space-x-3 mt-2">
                <span class="text-3xl">{{ task.targetItemAsset }}</span>
                <div class="w-full bg-slate-700 rounded-full h-4 relative">
                  <div class="bg-purple-500 h-4 rounded-full transition-all duration-500" [style.width.%]="(task.state.progress / task.targetQuantity) * 100"></div>
                  <span class="absolute inset-0 text-center text-xs font-bold leading-4 text-white/90">{{ task.state.progress }} / {{ task.targetQuantity }}</span>
                </div>
              </div>
            </div>

            <!-- Reward & Claim Button -->
            <div class="flex-shrink-0 flex flex-col items-center justify-center space-y-2 w-full sm:w-48">
              <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-1 text-yellow-400">
                  <span>ğŸ’°</span>
                  <span class="font-semibold">{{ task.reward.coins }}</span>
                </div>
                <div class="flex items-center space-x-1 text-blue-400">
                  <span>â­</span>
                  <span class="font-semibold">{{ task.reward.xp }}</span>
                </div>
              </div>
              
              @if(task.state.claimed) {
                <button disabled class="w-full px-4 py-2 rounded-lg font-bold bg-green-700 text-green-200 cursor-default">
                  Claimed
                </button>
              } @else {
                <button 
                  (click)="claim(task.id)"
                  [disabled]="!task.state.completed"
                  class="w-full px-4 py-2 rounded-lg font-bold text-white transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                  [class]="task.state.completed ? 'bg-purple-600 hover:bg-purple-700' : 'bg-slate-600'">
                    Claim
                </button>
              }
            </div>
          </div>
        }
      }
    </div>
  }
</div>